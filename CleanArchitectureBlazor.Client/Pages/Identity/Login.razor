@page "/login"
@using System.Net.Http.Headers
@inject HttpClient Http
@inject IJSRuntime JS
<h3>Login</h3>

@if (message != null)
{
    <p>@message</p>
}

<input @bind="username" placeholder="Username" />
<input @bind="password" type="password" placeholder="Password" />
<button @onclick="LoginUser">Login</button>

@code {
    private string username;
    private string password;
    private string message;

    private async Task LoginUser()
    {
        var model = new UserLoginModel { Username = username, Password = password };
        var response = await Http.PostAsJsonAsync("api/Authentication/Login", model);

        if (response.IsSuccessStatusCode)
        {
            var result = await response.Content.ReadFromJsonAsync<dynamic>();
            var token =Convert.ToString(result?.token) as string;

            // Store the token in localStorage
            JS.InvokeVoidAsync("localStorage.setItem", "authToken", token);
            message = "Login successful!";


        }
        else
        {
            message = "Login failed";
        }
    }
    private async Task GetToken()
    {
        var token = await JS.InvokeAsync<string>("localStorage.getItem", "authToken");
        Http.DefaultRequestHeaders.Authorization = new AuthenticationHeaderValue("Bearer", token);
    }
    public class UserLoginModel
    {
        public string Username { get; set; }
        public string Password { get; set; }
    }
}
